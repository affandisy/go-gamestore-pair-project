-- Migrasi database gamestore Postgresql

-- CUSTOMERS
CREATE TABLE IF NOT EXISTS Customers (
    CustomerID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Name VARCHAR(100) NOT NULL,
    Email VARCHAR(100) NOT NULL UNIQUE,
    Password VARCHAR(255) NOT NULL,
    CreatedAt TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    UpdatedAt TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- CATEGORIES
CREATE TABLE IF NOT EXISTS Categories (
    CategoryID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    Name VARCHAR(100) NOT NULL
);

-- GAMES
CREATE TABLE IF NOT EXISTS Games (
    GameID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CategoryID INT NOT NULL REFERENCES Categories(categoryID) ON DELETE RESTRICT,
    Titles VARCHAR(100) NOT NULL,
    Price NUMERIC(10,2) NOT NULL CHECK (price >= 0),
    CreatedAt TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    UpdatedAt TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- ORDERS
CREATE TABLE IF NOT EXISTS Orders (
    OrderID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CustomerID INT NOT NULL REFERENCES Customers(customerID) ON DELETE RESTRICT,
    GameID INT NOT NULL REFERENCES Games(gameID) ON DELETE RESTRICT,
    CreatedAt TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- PAYMENTS
CREATE TABLE IF NOT EXISTS Payments (
    PaymentID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    OrderID INT NOT NULL REFERENCES Orders(orderID) ON DELETE RESTRICT,
    Amount NUMERIC(12, 2) NOT NULL CHECK (amount >= 0),
    Status VARCHAR(50) NOT NULL,
    CreatedAt TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- Library
CREATE TABLE IF NOT EXISTS Library (
    LibraryID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CustomerID INT NOT NULL REFERENCES Customers(customerID) ON DELETE RESTRICT,
    GameID INT NOT NULL REFERENCES Games(gameID) ON DELETE RESTRICT,
    CreatedAt TIMESTAMPTZ NOT NULL DEFAULT NOW()
);


-- SAMPLE DATA